# ğŸ“Š æ•°æ®åº“åˆå§‹åŒ–æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èï¼‰

### Zeabur éƒ¨ç½²ï¼ˆä¸€é”®åˆå§‹åŒ–ï¼‰

å¦‚æœä½ ä½¿ç”¨ Zeabur éƒ¨ç½²ï¼Œåªéœ€æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. **åœ¨ Zeabur PostgreSQL Web Console ä¸­æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬**
   ```sql
   -- å¤åˆ¶å¹¶æ‰§è¡Œ init.sql çš„å…¨éƒ¨å†…å®¹
   ```

2. **éªŒè¯è¡¨åˆ›å»ºæˆåŠŸ**
   ```sql
   SELECT table_name FROM information_schema.tables 
   WHERE table_schema = 'public' 
   ORDER BY table_name;
   ```

3. **é¢„æœŸç»“æœï¼š3 ä¸ªè¡¨**
   - `users` - ç”¨æˆ·è¡¨
   - `otps` - éªŒè¯ç è¡¨
   - `reports` - æŠ¥å‘Šè¡¨

å®Œæˆï¼ğŸ‰

## ğŸ“ ç›®å½•ç»“æ„

```
database/
â”œâ”€â”€ schema.sql                  # âœ… ç”Ÿäº§ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰
â”œâ”€â”€ init.sql                    # âœ… å¿«é€ŸåŸå‹/æµ‹è¯•è„šæœ¬
â”œâ”€â”€ migrate_field_names.sql     # ğŸ”„ å­—æ®µåè¿ç§»è„šæœ¬
â”œâ”€â”€ optimize_indexes.sql        # ç´¢å¼•ä¼˜åŒ–è„šæœ¬
â”œâ”€â”€ setup.sh                    # è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ verify.sh                   # æ•°æ®åº“éªŒè¯è„šæœ¬
â”œâ”€â”€ README.md                   # æœ¬æ–‡æ¡£ï¼ˆå®Œæ•´æŒ‡å—ï¼‰
â”œâ”€â”€ QUICK_REFERENCE.md          # ğŸ“Œ å¿«é€Ÿå‚è€ƒï¼ˆå­—æ®µ/ç´¢å¼•é€ŸæŸ¥ï¼‰
â”œâ”€â”€ ALIYUN_RDS_GUIDE.md         # é˜¿é‡Œäº‘ RDS éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ FIELD_NAMING_CHANGES.md     # å­—æ®µå‘½åè§„èŒƒå˜æ›´è¯´æ˜
â”‚
â””â”€â”€ archive/                    # å½’æ¡£ç›®å½•
    â”œâ”€â”€ aliyun/                 # é˜¿é‡Œäº‘ RDS ç›¸å…³ï¼ˆå·²å½’æ¡£ï¼‰
    â”‚   â”œâ”€â”€ complete_setup.sql
    â”‚   â”œâ”€â”€ aliyun_rds_setup.sql
    â”‚   â”œâ”€â”€ SETUP_INSTRUCTIONS.md
    â”‚   â””â”€â”€ README.md
    â”‚
    â”œâ”€â”€ add_*.sql               # å†å²è¿ç§»è„šæœ¬
    â”œâ”€â”€ create_*.sql            # å•è¡¨åˆ›å»ºè„šæœ¬
    â””â”€â”€ README_ARCHIVE.md       # å½’æ¡£è¯´æ˜
```

## ğŸ“‹ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### ğŸ¢ `schema.sql` - ç”Ÿäº§ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

**å®Œæ•´çš„ç”Ÿäº§çº§æ•°æ®åº“æ¶æ„**ï¼ŒåŒ…å«ï¼š
- âœ… åˆ›å»ºæ•°æ®åº“æ‰©å±•ï¼ˆuuid-osspã€pgcryptoï¼‰
- âœ… åˆ›å»º 3 ä¸ªè¡¨ï¼š`users`ã€`otps`ã€`reports`
- âœ… å®Œæ•´çš„è¡¨ç»“æ„ï¼ˆreports è¡¨åŒ…å« 14 ä¸ªå­—æ®µï¼‰
- âœ… 13 ä¸ªä¼˜åŒ–ç´¢å¼•ï¼ˆåŒ…æ‹¬ GIN ç´¢å¼•ï¼‰
- âœ… å®Œæ•´çš„å­—æ®µæ³¨é‡Šï¼ˆä¾¿äºç»´æŠ¤ï¼‰
- âœ… è‡ªåŠ¨æ›´æ–° `updated_at` çš„è§¦å‘å™¨
- âœ… é€‚ç”¨äºé˜¿é‡Œäº‘ RDSã€è‡ªå»º PostgreSQL

**é€‚ç”¨åœºæ™¯**ï¼š
- ğŸ¢ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- ğŸ¢ é˜¿é‡Œäº‘ RDS
- ğŸ¢ è‡ªå»º PostgreSQL æœåŠ¡å™¨
- ğŸ¢ éœ€è¦å®Œæ•´å­—æ®µå’Œæˆæœ¬è¿½è¸ªåŠŸèƒ½

### ğŸ§ª `init.sql` - å¿«é€ŸåŸå‹/æµ‹è¯•è„šæœ¬

**ç®€åŒ–ç‰ˆæ•°æ®åº“æ¶æ„**ï¼ŒåŒ…å«ï¼š
- âœ… åˆ›å»º 3 ä¸ªè¡¨ï¼š`users`ã€`otps`ã€`reports`
- âœ… åŸºç¡€è¡¨ç»“æ„ï¼ˆreports è¡¨åªæœ‰ 6 ä¸ªæ ¸å¿ƒå­—æ®µï¼‰
- âœ… 5 ä¸ªåŸºç¡€ç´¢å¼•
- âœ… å¿«é€Ÿä¸Šæ‰‹ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘

**é€‚ç”¨åœºæ™¯**ï¼š
- ğŸ§ª Zeabur å¿«é€Ÿéƒ¨ç½²
- ğŸ§ª å¼€å‘ç¯å¢ƒæµ‹è¯•
- ğŸ§ª åŸå‹éªŒè¯
- ğŸ§ª MVP å¿«é€Ÿå¯åŠ¨

### ğŸ“Œ `QUICK_REFERENCE.md` - å¿«é€Ÿå‚è€ƒ

**å­—æ®µå’Œç´¢å¼•é€ŸæŸ¥è¡¨**ï¼ŒåŒ…å«ï¼š
- âœ… æ‰€æœ‰è¡¨çš„å­—æ®µåˆ—è¡¨
- âœ… æ‰€æœ‰ç´¢å¼•åˆ—è¡¨
- âœ… å¸¸ç”¨ SQL ç¤ºä¾‹
- âœ… è¿ç§»å‘½ä»¤é€ŸæŸ¥
- âœ… ä»£ç ç¤ºä¾‹ï¼ˆåç«¯/SQLï¼‰

**é€‚åˆ**ï¼šå¿«é€ŸæŸ¥æ‰¾å­—æ®µåã€ç¼–å†™ SQLã€ä»£ç å¼€å‘

### ğŸ“„ `ALIYUN_RDS_GUIDE.md` - é˜¿é‡Œäº‘ RDS éƒ¨ç½²æŒ‡å—

å®Œæ•´çš„é˜¿é‡Œäº‘ RDS PostgreSQL éƒ¨ç½²æ•™ç¨‹ï¼ŒåŒ…å«ï¼š
- åˆ›å»º RDS å®ä¾‹çš„è¯¦ç»†æ­¥éª¤
- å®‰å…¨é…ç½®å’Œæ€§èƒ½ä¼˜åŒ–
- æ•…éšœæ’æŸ¥æŒ‡å—

### ğŸ“ `FIELD_NAMING_CHANGES.md` - å­—æ®µå‘½åè§„èŒƒå˜æ›´è¯´æ˜

**é‡è¦ï¼** å¦‚æœä½ çš„åº”ç”¨ä»£ç å¼•ç”¨äº†ä»¥ä¸‹æ—§å­—æ®µåï¼Œè¯·æŸ¥çœ‹æ­¤æ–‡æ¡£ï¼š
- âŒ `password_hash` â†’ âœ… `passwd_hash`
- âŒ `audio_duration` â†’ âœ… `audio_dur`
- âŒ `cost_breakdown` â†’ âœ… `cost_detail`

æ­¤æ–‡æ¡£åŒ…å«ï¼š
- å‘½åå˜æ›´åŸå› å’Œè§„èŒƒ
- è¯¦ç»†çš„è¿ç§»æ­¥éª¤
- ä»£ç ä¿®æ”¹ç¤ºä¾‹ï¼ˆåç«¯/å‰ç«¯/SQLï¼‰

### ğŸ”„ `migrate_field_names.sql` - å­—æ®µåè¿ç§»è„šæœ¬

**è‡ªåŠ¨åŒ–è¿ç§»è„šæœ¬**ï¼Œç”¨äºå°†ç°æœ‰æ•°æ®åº“ä»æ—§å­—æ®µåè¿ç§»åˆ°æ–°å­—æ®µåï¼š

```bash
# âš ï¸ è¿ç§»å‰åŠ¡å¿…å¤‡ä»½æ•°æ®åº“ï¼
pg_dump $DATABASE_URL > backup_before_migration.sql

# æ‰§è¡Œè¿ç§»
psql $DATABASE_URL -f database/migrate_field_names.sql
```

**è„šæœ¬åŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹æ—§å­—æ®µæ˜¯å¦å­˜åœ¨
- âœ… åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼ˆå¤±è´¥è‡ªåŠ¨å›æ»šï¼‰
- âœ… é‡å‘½åå­—æ®µå’Œç´¢å¼•
- âœ… å®Œæ•´çš„è¿ç§»å‰åéªŒè¯
- âœ… æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
- âœ… æä¾›å›æ»šæ–¹æ¡ˆ

**ä½•æ—¶ä½¿ç”¨**ï¼š
- ğŸ”„ å·²æœ‰ç”Ÿäº§æ•°æ®åº“éœ€è¦å‡çº§åˆ°æ–°å‘½åè§„èŒƒ
- ğŸ”„ ä»æ—§ç‰ˆæœ¬ schema è¿ç§»åˆ°æ–°ç‰ˆæœ¬

### `optimize_indexes.sql` - ç´¢å¼•ä¼˜åŒ–

åœ¨ä»¥ä¸‹æƒ…å†µæ‰§è¡Œæ­¤è„šæœ¬ï¼š
- æ•°æ®é‡å¢é•¿åˆ° 10,000+ æ¡è®°å½•
- æŸ¥è¯¢æ€§èƒ½ä¸‹é™
- éœ€è¦ä¼˜åŒ–ç‰¹å®šæŸ¥è¯¢

### `setup.sh` å’Œ `verify.sh` - è‡ªåŠ¨åŒ–è„šæœ¬

```bash
# è‡ªåŠ¨åŒ–éƒ¨ç½²
./database/setup.sh

# éªŒè¯æ•°æ®åº“ç»“æ„
./database/verify.sh
```

## ğŸ¯ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³• 1ï¼šé˜¿é‡Œäº‘ RDSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰â­

**é€‚åˆæ­£å¼éƒ¨ç½²ï¼Œæ¨èä½¿ç”¨ `schema.sql`**

1. **ç™»å½•é˜¿é‡Œäº‘ RDS æ§åˆ¶å°**
   - ç¡®ä¿ PostgreSQL å®ä¾‹å·²åˆ›å»ºï¼ˆæ¨è PostgreSQL 14+ï¼‰
   - é…ç½®ç™½åå•ï¼ˆæ·»åŠ ä½ çš„ IP åœ°å€ï¼‰

2. **ä½¿ç”¨ DMS æˆ– pgAdmin è¿æ¥**
   ```
   ä¸»æœºï¼šyour-rds-instance.pg.rds.aliyuncs.com
   ç«¯å£ï¼š5432
   æ•°æ®åº“ï¼špostgresï¼ˆæˆ–è‡ªå®šä¹‰æ•°æ®åº“åï¼‰
   ç”¨æˆ·ï¼šä½ çš„ç”¨æˆ·å
   å¯†ç ï¼šä½ çš„å¯†ç 
   ```

3. **æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬**
   ```sql
   -- å¤åˆ¶å¹¶æ‰§è¡Œ database/schema.sql çš„å…¨éƒ¨å†…å®¹
   ```

4. **éªŒè¯éƒ¨ç½²**
   ```sql
   -- æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
   SELECT table_name FROM information_schema.tables 
   WHERE table_schema = 'public' 
   ORDER BY table_name;
   
   -- æ£€æŸ¥è§¦å‘å™¨
   SELECT trigger_name, event_object_table 
   FROM information_schema.triggers;
   ```

5. **é…ç½®åº”ç”¨ç¨‹åº**
   ```bash
   # .env æ–‡ä»¶
   DATABASE_URL="postgresql://username:password@your-rds.pg.rds.aliyuncs.com:5432/dbname"
   ```

### æ–¹æ³• 2ï¼šZeabur Web Consoleï¼ˆå¿«é€Ÿå¼€å‘ï¼‰

**é€‚åˆå¿«é€ŸåŸå‹ï¼Œä½¿ç”¨ `init.sql`**

1. ç™»å½• Zeabur Dashboard
2. è¿›å…¥ PostgreSQL æœåŠ¡
3. æ‰“å¼€ **Web Console**
4. å¤åˆ¶ `database/init.sql` çš„å…¨éƒ¨å†…å®¹
5. ç²˜è´´å¹¶æ‰§è¡Œ
6. éªŒè¯è¡¨åˆ›å»ºæˆåŠŸ

### æ–¹æ³• 3ï¼špsql å‘½ä»¤è¡Œ

```bash
# ç”Ÿäº§ç¯å¢ƒï¼ˆä½¿ç”¨ schema.sqlï¼‰
psql $DATABASE_URL -f database/schema.sql

# å¼€å‘ç¯å¢ƒï¼ˆä½¿ç”¨ init.sqlï¼‰
psql $DATABASE_URL -f database/init.sql

# æˆ–è€…ä½¿ç”¨å®Œæ•´è¿æ¥å­—ç¬¦ä¸²
psql "postgresql://user:password@host:port/database" -f database/schema.sql
```

### æ–¹æ³• 4ï¼šè‡ªåŠ¨åŒ–è„šæœ¬

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export DATABASE_URL="your_database_url"

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬ï¼ˆé»˜è®¤ä½¿ç”¨ schema.sqlï¼‰
cd /path/to/project
./database/setup.sh

# æˆ–æŒ‡å®šä½¿ç”¨ init.sql
./database/setup.sh init
```

## âœ… éªŒè¯æ•°æ®åº“ç»“æ„

### 1. æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨

```sql
SELECT table_name, 
       (SELECT COUNT(*) FROM information_schema.columns 
        WHERE columns.table_name = tables.table_name) as column_count
FROM information_schema.tables 
WHERE table_schema = 'public' 
ORDER BY table_name;
```

**é¢„æœŸç»“æœï¼š**
```
table_name | column_count
-----------+-------------
otps       | 7
reports    | 14
users      | 6
```

### 2. æ£€æŸ¥ç´¢å¼•

```sql
SELECT tablename, indexname 
FROM pg_indexes 
WHERE schemaname = 'public' 
ORDER BY tablename, indexname;
```

### 3. æµ‹è¯•è¿æ¥

```bash
# ä½¿ç”¨éªŒè¯è„šæœ¬
./database/verify.sh

# æˆ–è€…æ‰‹åŠ¨æµ‹è¯•
psql $DATABASE_URL -c "SELECT version();"
```

## ğŸ“Š è¡¨ç»“æ„è¯´æ˜

### ğŸ¢ schema.sqlï¼ˆç”Ÿäº§ç‰ˆï¼‰vs ğŸ§ª init.sqlï¼ˆç®€åŒ–ç‰ˆï¼‰

#### usersï¼ˆç”¨æˆ·è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | schema.sql | init.sql | è¯´æ˜ |
|------|------|-----------|----------|------|
| id | UUID | âœ… | âœ… | ä¸»é”® |
| email | TEXT/VARCHAR(255) | âœ… | âœ… | é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰ |
| passwd_hash | TEXT/VARCHAR(255) | âœ… | âœ… | å¯†ç å“ˆå¸Œå€¼ |
| last_login | TIMESTAMP | âœ… | âŒ | æœ€åç™»å½•æ—¶é—´ |
| created_at | TIMESTAMP | âœ… | âœ… | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | âœ… | âœ… | æ›´æ–°æ—¶é—´ |

#### otpsï¼ˆéªŒè¯ç è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | schema.sql | init.sql | è¯´æ˜ |
|------|------|-----------|----------|------|
| id | UUID | âœ… | âœ… | ä¸»é”® |
| email | TEXT/VARCHAR(255) | âœ… | âœ… | é‚®ç®± |
| code | TEXT/VARCHAR(6) | âœ… | âœ… | éªŒè¯ç  |
| expires_at | TIMESTAMP | âœ… | âœ… | è¿‡æœŸæ—¶é—´ |
| used | BOOLEAN | âœ… | âœ… | æ˜¯å¦å·²ä½¿ç”¨ |
| used_at | TIMESTAMP | âŒ | âœ… | ä½¿ç”¨æ—¶é—´ |
| created_at | TIMESTAMP | âœ… | âœ… | åˆ›å»ºæ—¶é—´ |

#### reportsï¼ˆæŠ¥å‘Šè¡¨ï¼‰â­ ä¸»è¦åŒºåˆ«

| å­—æ®µ | ç±»å‹ | schema.sql | init.sql | è¯´æ˜ |
|------|------|-----------|----------|------|
| id | UUID | âœ… | âœ… | ä¸»é”® |
| user_id | UUID | âœ… | âœ… | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| user_email | TEXT | âœ… | âŒ | ç”¨æˆ·é‚®ç®± |
| student_id | TEXT | âœ… | âœ… | å­¦ç”ŸIDï¼ˆå¿…å¡«ï¼‰ |
| student_name | TEXT | âœ… | âŒ | å­¦ç”Ÿå§“å |
| file_name | TEXT | âœ… | âŒ | æ–‡ä»¶å |
| file_url | TEXT | âœ… | âŒ | æ–‡ä»¶URL |
| video_url | TEXT | âœ… | âœ… | è§†é¢‘URL |
| audio_dur | INTEGER | âœ… | âŒ | éŸ³é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰ |
| transcript | TEXT | âœ… | âœ… | è½¬å½•æ–‡æœ¬ |
| analysis | JSONB | âœ… | âœ… | åˆ†æç»“æœ |
| analysis_data | JSONB | âœ… | âŒ | å®Œæ•´åˆ†ææ•°æ® |
| cost_detail | JSONB | âœ… | âŒ | æˆæœ¬è¯¦æƒ… |
| total_cost | DECIMAL(10,4) | âœ… | âŒ | æ€»æˆæœ¬ |
| created_at | TIMESTAMP | âœ… | âœ… | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | âœ… | âœ… | æ›´æ–°æ—¶é—´ |

### ğŸ“ˆ ç´¢å¼•å¯¹æ¯”

| ç´¢å¼•ç±»å‹ | schema.sql | init.sql |
|---------|-----------|----------|
| users è¡¨ç´¢å¼• | 2 ä¸ª | 1 ä¸ª |
| otps è¡¨ç´¢å¼• | 3 ä¸ª | 3 ä¸ª |
| reports è¡¨ç´¢å¼• | 8 ä¸ªï¼ˆå« GINï¼‰ | 2 ä¸ª |
| **æ€»è®¡** | **13 ä¸ª** | **6 ä¸ª** |

### ğŸ¯ é€‰æ‹©å»ºè®®

**ä½¿ç”¨ schema.sqlï¼ˆç”Ÿäº§ç‰ˆï¼‰å¦‚æœï¼š**
- âœ… éœ€è¦è¿½è¸ªæˆæœ¬æ•°æ®ï¼ˆ`cost_detail`ã€`total_cost`ï¼‰
- âœ… éœ€è¦å­¦ç”Ÿä¿¡æ¯ï¼ˆ`student_id`ã€`student_name`ï¼‰
- âœ… éœ€è¦æ–‡ä»¶ç®¡ç†ï¼ˆ`file_name`ã€`file_url`ï¼‰
- âœ… éœ€è¦æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ï¼ˆ13ä¸ªç´¢å¼•ï¼‰
- âœ… éœ€è¦è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³ï¼ˆè§¦å‘å™¨ï¼‰
- âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**ä½¿ç”¨ init.sqlï¼ˆç®€åŒ–ç‰ˆï¼‰å¦‚æœï¼š**
- âœ… å¿«é€ŸåŸå‹éªŒè¯
- âœ… MVP æœ€å°å¯è¡Œäº§å“
- âœ… å¼€å‘ç¯å¢ƒæµ‹è¯•
- âœ… ä¸éœ€è¦æˆæœ¬è¿½è¸ª

## ğŸ“ å‘½åè§„èŒƒè¯´æ˜

æœ¬æ•°æ®åº“æ¶æ„éµå¾ªä»¥ä¸‹å‘½åè§„èŒƒï¼š

### âœ… å·²éµå¾ªçš„è§„èŒƒ

1. **éå”¯ä¸€ç´¢å¼•**ï¼šä½¿ç”¨ `idx_` å‰ç¼€
   - `idx_users_created_at`
   - `idx_reports_user_id`

2. **å”¯ä¸€ç´¢å¼•**ï¼šä½¿ç”¨ `uniq_` å‰ç¼€
   - `uniq_users_email`ï¼ˆé‚®ç®±å”¯ä¸€ç´¢å¼•ï¼‰

3. **è¡¨åå’Œå­—æ®µå**ï¼š
   - âœ… å°å†™å­—æ¯ + ä¸‹åˆ’çº¿åˆ†éš”
   - âœ… ä¸ä½¿ç”¨æ•°æ®åº“ä¿ç•™å­—
   - âœ… å­—æ®µåä¸è¶…è¿‡ 12 ä¸ªå­—ç¬¦ï¼ˆå»ºè®®ï¼‰

### ğŸ“ å­—æ®µå‘½åå˜æ›´

ä¸ºç¬¦åˆ 12 å­—ç¬¦é™åˆ¶ï¼Œéƒ¨åˆ†å­—æ®µå·²é‡å‘½åï¼š

| æ—§å­—æ®µå | æ–°å­—æ®µå | è¯´æ˜ |
|---------|---------|------|
| `password_hash` | `passwd_hash` | å¯†ç å“ˆå¸Œå€¼ï¼ˆ13â†’11å­—ç¬¦ï¼‰ |
| `audio_duration` | `audio_dur` | éŸ³é¢‘æ—¶é•¿ï¼ˆ14â†’9å­—ç¬¦ï¼‰ |
| `cost_breakdown` | `cost_detail` | æˆæœ¬æ˜ç»†ï¼ˆ14â†’11å­—ç¬¦ï¼‰ |

**âš ï¸ é‡è¦æé†’**ï¼šå¦‚æœä½ çš„åº”ç”¨ä»£ç ä½¿ç”¨äº†æ—§å­—æ®µåï¼Œè¯·æŸ¥çœ‹ [FIELD_NAMING_CHANGES.md](FIELD_NAMING_CHANGES.md) è·å–å®Œæ•´çš„è¿ç§»æŒ‡å—ã€‚

## ğŸ”§ å¸¸è§é—®é¢˜

### 1. "è¡¨å·²å­˜åœ¨"é”™è¯¯

è¿™æ˜¯æ­£å¸¸çš„ï¼Œè„šæœ¬ä½¿ç”¨ `CREATE TABLE IF NOT EXISTS`ï¼Œå¯ä»¥å®‰å…¨åœ°é‡å¤æ‰§è¡Œã€‚

### 2. è¿æ¥è¢«æ‹’ç»

æ£€æŸ¥ï¼š
- âœ… æ•°æ®åº“æœåŠ¡æ˜¯å¦è¿è¡Œ
- âœ… è¿æ¥å­—ç¬¦ä¸²æ˜¯å¦æ­£ç¡®
- âœ… ç½‘ç»œæ˜¯å¦å¯è¾¾
- âœ… å®‰å…¨ç»„/é˜²ç«å¢™é…ç½®

### 3. æƒé™ä¸è¶³

ç¡®ä¿æ•°æ®åº“ç”¨æˆ·å…·æœ‰ä»¥ä¸‹æƒé™ï¼š
- CREATE TABLE
- CREATE INDEX
- SELECT, INSERT, UPDATE, DELETE

### 4. å­—æ®µä¸å­˜åœ¨

å¦‚æœé‡åˆ°å­—æ®µä¸å­˜åœ¨çš„é”™è¯¯ï¼š
1. åˆ é™¤ç°æœ‰è¡¨ï¼š`DROP TABLE users, otps, reports CASCADE;`
2. é‡æ–°æ‰§è¡Œ `init.sql`

## ğŸ§ª å¼€å‘ç¯å¢ƒæµ‹è¯•

### æœ¬åœ° PostgreSQL æµ‹è¯•

```bash
# ä½¿ç”¨ Docker å¯åŠ¨æœ¬åœ°æ•°æ®åº“
docker run -d \
  --name test-postgres \
  -e POSTGRES_PASSWORD=testpass \
  -e POSTGRES_DB=testdb \
  -p 5432:5432 \
  postgres:17-alpine

# åˆå§‹åŒ–æ•°æ®åº“
export DATABASE_URL="postgresql://postgres:testpass@localhost:5432/testdb"
psql $DATABASE_URL -f database/init.sql

# éªŒè¯
./database/verify.sh
```

### è¿è¡Œé›†æˆæµ‹è¯•

```bash
# ç¡®ä¿æ•°æ®åº“å·²åˆå§‹åŒ–
npm test -- tests/integration/database.test.ts
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å®šæœŸæ‰§è¡Œç´¢å¼•ä¼˜åŒ–

```bash
psql $DATABASE_URL -f database/optimize_indexes.sql
```

### 2. ç›‘æ§æŸ¥è¯¢æ€§èƒ½

```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT query, mean_exec_time, calls 
FROM pg_stat_statements 
ORDER BY mean_exec_time DESC 
LIMIT 10;
```

### 3. å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

```sql
-- æ¸…ç†è¿‡æœŸçš„éªŒè¯ç ï¼ˆ7å¤©å‰ï¼‰
DELETE FROM otps 
WHERE created_at < NOW() - INTERVAL '7 days';

-- æ¸…ç†æ—§çš„æµ‹è¯•æŠ¥å‘Šï¼ˆå¯é€‰ï¼‰
DELETE FROM reports 
WHERE created_at < NOW() - INTERVAL '30 days' 
  AND student_id LIKE 'test_%';
```

## ğŸ“¦ å½’æ¡£æ–‡ä»¶è¯´æ˜

### `archive/` ç›®å½•

åŒ…å«å†å²æ–‡ä»¶å’Œä¸å†ä½¿ç”¨çš„é…ç½®ï¼š

- **`archive/aliyun/`** - é˜¿é‡Œäº‘ RDS ç›¸å…³æ–‡ä»¶ï¼ˆå·²åœç”¨ï¼‰
- **`archive/schema.sql`** - æ—§çš„ schema æ–‡ä»¶ï¼ˆå·²åˆå¹¶åˆ° init.sqlï¼‰
- **`archive/add_*.sql`** - å†å²è¿ç§»è„šæœ¬ï¼ˆå·²åˆå¹¶åˆ° init.sqlï¼‰
- **`archive/create_*.sql`** - å•è¡¨åˆ›å»ºè„šæœ¬ï¼ˆå·²åˆå¹¶åˆ° init.sqlï¼‰

è¿™äº›æ–‡ä»¶ä¿ç•™ç”¨äºå†å²å‚è€ƒï¼Œ**ä¸åº”åœ¨æ–°éƒ¨ç½²ä¸­ä½¿ç”¨**ã€‚

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¸è¦æäº¤æ•æ„Ÿä¿¡æ¯**ï¼š`.gitignore` åº”åŒ…å« `.env` æ–‡ä»¶
2. **ä½¿ç”¨å¼ºå¯†ç **ï¼šæ•°æ®åº“å¯†ç è‡³å°‘ 16 å­—ç¬¦
3. **å¯ç”¨ SSL**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨åŠ å¯†è¿æ¥
4. **å®šæœŸå¤‡ä»½**ï¼šä½¿ç”¨ `pg_dump` æˆ–äº‘å¹³å°è‡ªåŠ¨å¤‡ä»½
5. **æœ€å°æƒé™åŸåˆ™**ï¼šåº”ç”¨ç¨‹åºç”¨æˆ·ä¸éœ€è¦ SUPERUSER æƒé™

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

- ğŸ“– å‚è€ƒé¡¹ç›®æ ¹ç›®å½•çš„ `QUICKSTART_ZEABUR.md`
- ğŸ› é‡åˆ°é—®é¢˜è¯·æ£€æŸ¥ `tests/README.md`
- ğŸ’¬ æŸ¥çœ‹é¡¹ç›® Issues æˆ–æäº¤æ–°é—®é¢˜

---

**å½“å‰ç‰ˆæœ¬**ï¼šv2.0ï¼ˆç®€åŒ–ç‰ˆï¼Œ2025-11-17ï¼‰  
**ä¸Šæ¬¡æ›´æ–°**ï¼š2025-11-17
