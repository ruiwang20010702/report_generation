name: english-learning-assistant

# Zeabur 项目配置
# 文档：https://zeabur.com/docs

services:
  # 主应用服务（前后端一体）
  app:
    type: nodejs
    buildCommand: npm ci && npm run build
    startCommand: npm start
    
    # 资源配置
    resources:
      cpu: 2      # 2核CPU
      memory: 4096 # 4GB内存
    
    # 自动扩展配置（支持100并发）
    # 临时注释掉，等镜像拉取成功后再启用
    # scaling:
    #   minReplicas: 1
    #   maxReplicas: 5
    #   targetCPU: 60
    
    # 健康检查
    healthCheck:
      path: /api/health
      initialDelaySeconds: 30
      periodSeconds: 10
    
    # 环境变量（这里只定义key，值在Zeabur控制台设置）
    env:
      NODE_ENV: production
      USE_MOCK_ANALYSIS: false
      # PORT 由 Zeabur 自动注入，不需要手动设置
      
      # 阿里云 RDS PostgreSQL 数据库配置
      # 注意：不再使用 Zeabur 自带的数据库，改用阿里云 RDS
      DB_HOST: pgm-2zeocagx2zo8v2c55o.rwlb.rds.aliyuncs.com
      DB_PORT: 5432
      DB_NAME: report_generation
      DB_USER: wangrui003
      # DB_PASSWORD 在控制台设置（敏感信息）
      DB_SSL: false
      
      # 其他敏感变量在控制台设置：
      # - DB_PASSWORD
      # - JWT_SECRET
      # - ALIYUN_ACCESS_KEY_ID
      # - ALIYUN_ACCESS_KEY_SECRET
      # - ALIYUN_TINGWU_APP_KEY
      # - GLM_API_KEY
      # - SMTP_PASS
      # - SENTRY_DSN
