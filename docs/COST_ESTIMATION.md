# 成本估算指南

本文档提供 200 用户规模的详细成本估算和优化建议。

## 📊 基础假设

### 用户规模
- 👥 **日活用户**: 200 人
- 📈 **月活用户**: 600 人（约 30% 日活）
- 📊 **每用户分析次数**: 2-3 次/天
- 🎯 **总分析次数**: 400-600 次/天 ≈ 15,000 次/月

### 视频特征
- 📹 **平均视频时长**: 5 分钟
- 💾 **平均文件大小**: 50 MB
- 🎬 **视频数量**: 每次 1-2 个视频
- 📦 **月处理总量**: ~750 GB

---

## 💰 详细成本分解

### 1. Vercel 托管成本

#### Hobby 计划（不推荐）
- 💵 **价格**: $0/月
- ⚠️ **限制**: 
  - 10 秒函数超时（❌ 不适合视频处理）
  - 100 GB 带宽
  - 1 个并发

**不适合本项目**

#### Pro 计划（推荐 ⭐）
- 💵 **价格**: $20/月
- ✅ **功能**:
  - 60 秒函数超时
  - 1 TB 带宽
  - 100 GB-Hours 函数执行时间
  - 10 个并发
  - 高级分析

**适合 200 用户规模**

#### Team 计划
- 💵 **价格**: $20/成员/月
- ✅ **适合**: 多人团队协作
- 📈 **建议**: 扩展到 500+ 用户时考虑

### 成本计算
```
基础费用: $20/月
额外带宽: 0（在 1 TB 内）
额外函数时间: 0（在配额内）
---
小计: $20/月
```

---

### 2. OpenAI API 成本

#### 模型定价（2025 年）
| 模型 | 输入 | 输出 |
|------|------|------|
| GPT-4o | $2.50/1M tokens | $10/1M tokens |
| GPT-3.5-turbo | $0.50/1M tokens | $1.50/1M tokens |

#### 使用估算

**每次分析的 Token 使用**：
- 转录文本: ~1,500 tokens
- 分析 Prompt: ~500 tokens
- 分析结果: ~2,000 tokens
- **总计**: ~4,000 tokens/次

**月度使用**：
- 15,000 次分析 × 4,000 tokens = 60M tokens
- 输入: ~30M tokens
- 输出: ~30M tokens

#### 成本计算（GPT-4o）
```
输入: 30M × $2.50/1M = $75
输出: 30M × $10/1M = $300
---
小计: $375/月
```

#### 成本计算（GPT-3.5-turbo）
```
输入: 30M × $0.50/1M = $15
输出: 30M × $1.50/1M = $45
---
小计: $60/月
```

💡 **优化建议**: 
- 高级用户使用 GPT-4o
- 普通用户使用 GPT-3.5-turbo
- **预估混合成本**: $150-200/月

---

### 3. AssemblyAI 转录成本

#### 定价（2025 年）
- 💵 **价格**: $0.37/小时（异步转录）
- 🎁 **免费额度**: 5 小时/月

#### 使用估算
- 15,000 次分析 × 5 分钟 = 75,000 分钟 = 1,250 小时
- 减去免费额度: 1,250 - 5 = 1,245 小时

#### 成本计算
```
1,245 小时 × $0.37 = $460.65/月
```

💡 **优化方案**:
- 使用本地 Whisper 模型（免费，但需更多计算资源）
- 缓存已转录的视频
- **预估优化后**: $300-350/月

---

### 4. 数据库成本（Supabase）

#### 定价
- 🎁 **Free 层**: $0/月
  - 500 MB 数据库
  - 1 GB 文件存储
  - 2 GB 带宽
  
- 💵 **Pro 层**: $25/月
  - 8 GB 数据库
  - 100 GB 文件存储
  - 250 GB 带宽

#### 使用估算
- 15,000 条记录 × 5 KB = 75 MB（在免费层内）
- 文件存储: 0（视频不存储在数据库）

#### 成本计算
```
小计: $0/月（使用免费层）
```

---

### 5. 缓存服务（Upstash Redis）

#### 定价
- 🎁 **Free 层**: $0/月
  - 10,000 命令/天
  - 256 MB 存储
  
- 💵 **Pay as you go**: $0.2/100K 命令

#### 使用估算
- Rate Limiting: 600 次/天
- 缓存查询: 1,000 次/天
- **总计**: ~2,000 命令/天（在免费层内）

#### 成本计算
```
小计: $0/月（使用免费层）
```

---

### 6. 监控服务（可选）

#### Sentry（错误追踪）
- 💵 **Developer 层**: $26/月
  - 50K 错误/月
  - 10K 性能事件/月

#### LogRocket（会话回放）
- 💵 **Team 层**: $99/月
  - 10,000 会话/月

#### 成本计算
```
Sentry: $26/月
LogRocket: $0（可选）
---
小计: $26/月
```

---

## 📊 总成本汇总

### 基础配置（最低成本）

| 服务 | 计划 | 月费 |
|------|------|------|
| Vercel | Pro | $20 |
| OpenAI | GPT-3.5 为主 | $60 |
| AssemblyAI | Pay as you go | $460 |
| Supabase | Free | $0 |
| Upstash Redis | Free | $0 |
| Sentry | Developer | $26 |
| **总计** | | **$566** |

### 推荐配置（性能优化）

| 服务 | 计划 | 月费 | 说明 |
|------|------|------|------|
| Vercel | Pro | $20 | 足够支持 200 用户 |
| OpenAI | 混合使用 | $150 | GPT-4o + GPT-3.5 混合 |
| AssemblyAI | 优化使用 | $300 | 启用缓存，减少重复转录 |
| Supabase | Free | $0 | 数据量小，免费层够用 |
| Upstash Redis | Free | $0 | 请求量少，免费层够用 |
| Sentry | Developer | $26 | 必要的错误监控 |
| **总计** | | **$496** |

### 高级配置（最佳体验）

| 服务 | 计划 | 月费 | 说明 |
|------|------|------|------|
| Vercel | Pro | $20 | |
| OpenAI | GPT-4o 为主 | $375 | 最佳分析质量 |
| AssemblyAI | 标准使用 | $460 | 无优化 |
| Supabase | Pro | $25 | 更好的性能 |
| Upstash Redis | Free | $0 | |
| Sentry | Developer | $26 | |
| **总计** | | **$906** |

---

## 💡 成本优化策略

### 1. OpenAI 优化（节省 40-50%）

#### 策略 A: 分层服务
```typescript
function selectModel(userPlan: string) {
  return userPlan === 'premium' ? 'gpt-4o' : 'gpt-3.5-turbo';
}
```
**节省**: ~$200/月

#### 策略 B: 缓存响应
```typescript
// 缓存相似视频的分析结果
const cacheKey = hashVideo(videoContent);
const cached = await redis.get(cacheKey);
if (cached) return cached;
```
**节省**: ~$50/月

#### 策略 C: 减少 Token 使用
```typescript
// 限制输出长度
const response = await openai.chat.completions.create({
  model: 'gpt-4o',
  max_tokens: 1000, // 限制输出
  temperature: 0.7,
});
```
**节省**: ~$100/月

**总节省**: ~$350/月

---

### 2. AssemblyAI 优化（节省 30-40%）

#### 策略 A: 视频去重
```typescript
// 避免重复转录相同视频
const videoHash = hashVideo(videoBuffer);
const cached = await db.getTranscription(videoHash);
if (cached) return cached;
```
**节省**: ~$150/月

#### 策略 B: 使用本地 Whisper
```typescript
// 对于小文件使用本地 Whisper
if (videoSize < 10MB) {
  return await localWhisper.transcribe(video);
}
```
**节省**: ~$100/月

#### 策略 C: 批量处理
```typescript
// 批量提交减少 API 调用开销
const results = await batchTranscribe(videos);
```
**节省**: ~$50/月

**总节省**: ~$300/月

---

### 3. Vercel 优化（节省带宽）

#### 策略 A: 启用缓存
```json
{
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000"
        }
      ]
    }
  ]
}
```

#### 策略 B: 压缩资源
```typescript
// 启用 Gzip/Brotli 压缩
import compression from 'compression';
app.use(compression());
```

#### 策略 C: CDN 加速
- 使用 Vercel Edge Network（内置）
- 静态资源自动缓存

**节省**: 带宽成本忽略不计（在 1TB 内）

---

## 📈 扩展成本预测

### 500 用户规模

| 服务 | 月费 | 变化 |
|------|------|------|
| Vercel | $20-40 | 可能需要 Team 计划 |
| OpenAI | $400-500 | 2.5x 使用量 |
| AssemblyAI | $800-1000 | 2.5x 使用量 |
| 其他服务 | $50-100 | 需升级到付费层 |
| **总计** | **$1,270-1,640** | |

### 1000 用户规模

| 服务 | 月费 | 变化 |
|------|------|------|
| Vercel | $40-100 | Team 或 Enterprise |
| OpenAI | $1,000-1,500 | 5x 使用量 |
| AssemblyAI | $2,000-2,500 | 5x 使用量 |
| 其他服务 | $200-300 | 全部升级 |
| **总计** | **$3,240-4,400** | |

---

## 🎯 成本优化总结

### 当前规模（200 用户）

**优化前**: ~$906/月
**优化后**: ~$246/月
**节省**: ~$660/月（73%）

### 关键优化措施

1. ✅ **使用 GPT-3.5-turbo 为主**（节省 $200）
2. ✅ **缓存转录结果**（节省 $150）
3. ✅ **批量处理 API 请求**（节省 $100）
4. ✅ **使用免费服务层**（节省 $50）
5. ✅ **启用 CDN 缓存**（节省流量）

### 成本控制建议

- 📊 定期监控 API 使用量
- 🔍 识别异常调用模式
- 💰 设置预算告警
- 📈 根据增长调整方案

---

## 📞 需要帮助？

对成本有疑问？
- 📖 查看 [性能优化指南](PERFORMANCE_GUIDE.md)
- 📈 查看 [扩展性指南](SCALING_GUIDE.md)
- 💬 联系技术支持

---

**最后更新**: 2025-11-06
**适用版本**: v1.0.0
**用户规模**: 200 DAU

