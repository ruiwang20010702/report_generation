# 🧪 测试命令说明

本文档列出所有可用的测试命令，帮助你验证配置和对比模型性能。

---

## 📋 可用命令

### 🔷 测试 DeepSeek

```bash
npm run test:deepseek
```

**测试内容：**
- ✅ API 连接状态
- ⏱️ 响应速度
- 💰 Token 使用和成本
- 📝 实际回复内容

**预期输出：**
```
============================================================
🔷 DeepSeek API 连接测试
============================================================

✅ API Key 已配置
🔌 正在连接 DeepSeek API...

✅ DeepSeek API 连接成功！

📊 测试结果：
   ⏱️  响应时间: 1.5 秒
   📝 模型: deepseek-chat
   💬 回复内容: 我是一位专业的英语教学专家...

💰 Token 使用：
   输入: 45 tokens
   输出: 67 tokens
   总计: 112 tokens
   💵 成本: ¥0.000157

✨ 特性：
   ✅ 国内直连（无需 VPN）
   ✅ 超高性价比（比 GPT-4 便宜 95%）
   ✅ 强大推理能力
   ✅ 支持 32K 上下文
   ✅ 新用户送 500万 tokens 免费额度
```

---

### 🇨🇳 测试通义千问

```bash
npm run test:qwen
```

**测试内容：**
- ✅ API 连接状态
- ⏱️ 响应速度
- 💰 Token 使用和成本
- 📊 免费额度信息

**预期输出：**
```
============================================================
🇨🇳 通义千问 API 连接测试
============================================================

✅ API Key 已配置
🔌 正在连接通义千问 API...

✅ 通义千问 API 连接成功！

📊 测试结果：
   ⏱️  响应时间: 1.2 秒
   📝 模型: qwen-plus
   💬 回复内容: 我是一位专业的英语教学专家...

💰 免费额度：
   每月 100万 tokens 免费
   约等于 1000 次分析
```

---

### 🧠 测试智谱 GLM

```bash
npm run test:glm
```

**测试内容：**
- ✅ API 连接状态
- ⏱️ 响应速度
- 💰 不同模型的成本对比
- 📝 质量评估

**预期输出：**
```
============================================================
🧠 智谱 GLM-4 API 连接测试
============================================================

✅ API Key 已配置
🔌 正在连接智谱 GLM API...

✅ 智谱 GLM API 连接成功！

📊 测试结果：
   ⏱️  响应时间: 1.8 秒
   📝 模型: glm-4-plus
   💬 回复内容: 我是一位专业的英语教学专家...

💡 模型选择：
   - glm-4-plus: 最强性能（付费）
   - glm-4-flash: 经济实惠（免费，有限速）
```

---

### 🎯 对比所有模型（推荐！）

```bash
npm run test:models
```

**测试内容：**
- 🔄 并行测试所有已配置的模型
- 📊 生成性能对比表
- 💰 成本对比分析
- 💡 个性化推荐方案

**预期输出：**
```
============================================================
🎯 国内 AI 模型对比测试
============================================================

📋 测试任务：分析学生英语学习表现（典型使用场景）
📊 测试指标：响应速度、成本、可用性

🔄 正在测试所有模型...

✅ 测试完成！

============================================================
📊 性能对比表
============================================================

模型        | 状态 | 响应时间 | Tokens | 成本(¥)   | 回复预览
--------------------------------------------------------------------------------
🔷 DeepSeek  | ✅ |    1.5s |    112 | 0.000157 | 我是一位专业的英语教学专家...
🇨🇳 通义千问  | ✅ |    1.2s |    108 | 0.000000 | 我是一位专业的英语教学专家...
🧠 智谱GLM   | ✅ |    1.8s |    115 | 0.005750 | 我是一位专业的英语教学专家...

============================================================
💡 推荐方案（按性价比排序）
============================================================

🥇 DeepSeek
   理由: 超高性价比，比 GPT-4 便宜 95%，新用户送 500万 tokens
   成本: ~¥0.06/百次分析

🥈 通义千问 (Qwen)
   理由: 阿里云服务，100万 tokens/月免费，足够个人使用
   成本: 前 100万 tokens 免费

🥉 智谱 GLM-4
   理由: 清华背景，高准确率，送 25元体验金，GLM-4-Flash 免费
   成本: ~¥0.30/百次分析

⚡ 最快响应: 🇨🇳 通义千问 (1.2s)
💰 最低成本: 🇨🇳 通义千问 (¥0.000000)

============================================================
🎯 配置建议
============================================================

轻度使用（每月 < 100 次分析）：
  → 通义千问（免费额度内）

中度使用（每月 100-1000 次分析）：
  → DeepSeek（性价比最高）

重度使用（需要最高质量）：
  → 主用 DeepSeek，关键场景用 GPT-4
```

---

## 🔍 测试场景说明

所有测试都使用相同的场景：

**系统提示词：**
```
你是一位专业的英语教学专家。
```

**用户问题：**
```
请简短介绍一下你的能力，50字以内。
```

这个场景模拟了实际使用中的典型任务，测试结果能较好地反映实际性能。

---

## 📊 如何解读测试结果

### 响应时间
- **< 2秒**：优秀，适合实时场景
- **2-5秒**：良好，正常使用无感知
- **> 5秒**：较慢，可能需要优化或换模型

### Token 使用
- 相同任务下，不同模型的 token 消耗基本相似
- 主要影响因素是提示词长度和回复长度
- 典型的 5 分钟视频分析约消耗 3000-5000 tokens

### 成本
- 看单次成本，也要看免费额度
- 通义千问虽然单价不是最低，但有大量免费额度
- DeepSeek 单价最低，适合大量使用

### 质量
- 所有国内模型在英语教学场景下质量都很好
- 差异主要在细节处理和语言风格上
- 建议实际测试后根据需求选择

---

## ❌ 常见错误和解决

### 错误 1：未配置 API Key

```
❌ 未配置 DEEPSEEK_API_KEY
```

**解决方法：**
```bash
# 在 .env 文件中添加
DEEPSEEK_API_KEY=sk-你的密钥
```

### 错误 2：API Key 无效

```
❌ DeepSeek API 调用失败
状态码: 401
错误信息: Invalid API key
```

**解决方法：**
1. 检查 API Key 是否复制完整
2. 确认是否包含 `sk-` 前缀
3. 重新生成 API Key

### 错误 3：网络连接失败

```
❌ 连接超时
```

**解决方法：**
1. 检查网络连接
2. 对于 OpenAI，确保代理正常
3. 尝试其他模型

### 错误 4：余额不足

```
❌ Insufficient balance
```

**解决方法：**
1. 检查账户余额
2. 充值或使用免费额度的模型
3. 切换到其他模型

---

## 💡 最佳实践

### 1. 首次配置
```bash
# 一次性测试所有模型
npm run test:models
```
根据结果选择最适合的模型。

### 2. 定期检查
```bash
# 每周或每月运行一次
npm run test:models
```
确保配置正常，监控成本变化。

### 3. 切换模型前
```bash
# 先测试新模型
npm run test:deepseek  # 或其他模型
```
确认正常后再切换。

### 4. 排查问题
```bash
# 逐个测试定位问题
npm run test:deepseek
npm run test:qwen
npm run test:glm
```

---

## 🚀 下一步

测试通过后：

1. **启动服务**
   ```bash
   npm run dev:all
   ```

2. **访问应用**
   ```
   http://localhost:8080
   ```

3. **开始分析**
   - 上传视频
   - 关闭"使用模拟数据"
   - 点击"开始分析"

4. **查看日志**
   ```
   后端终端会显示使用的模型和处理进度
   ```

---

## 📚 相关文档

- [快速开始 - 国内AI模型](./快速开始-国内AI模型.md)
- [AI模型对比](./AI模型对比.md)
- [国内用户使用指南](./国内用户使用指南.md)

---

**💡 提示**：如果所有测试都失败，可能是网络问题或 .env 配置问题，请先检查这两项。

