# 🎙️ 视频转文本服务说明

## ⚠️ 重要说明

**当前系统配置：强制使用阿里云语音服务**

为了确保输出一致性，系统当前已配置为**强制使用阿里云语音服务**，不再支持自动降级到其他服务。

---

## 🎯 当前配置状态

### ✅ 当前使用的服务

| 服务名称 | 配置状态 | 免费额度 | 特点 |
|---------|---------|---------|------|
| 🇨🇳 **阿里云语音** | ✅ **强制使用** | 每月 **2 小时**（120分钟）| 国内直连，无需VPN，速度快 |

### ❌ 已禁用的服务

| 服务名称 | 状态 | 说明 |
|---------|------|------|
| 🌍 **AssemblyAI** | ❌ 已禁用 | 不再支持降级到此服务 |
| 🤖 **OpenAI Whisper** | ❌ 已禁用 | 不再支持降级到此服务 |

---

## 🚀 当前工作流程

```
┌─────────────────────────────────────────────────────┐
│  🇨🇳 阿里云智能语音服务（强制使用）                  │
│     ✅ 国内直连，免费 2h/月                          │
│     ✅ 支持说话人识别（区分老师/学生）                │
│     ✅ 直接传 URL，无需下载视频                      │
│     ✅ 速度快、稳定性高                              │
└─────────────────────────────────────────────────────┘
```

> **注意**：如果阿里云不可用或额度用完，系统会报错。需要：
> 1. 检查API Key配置是否正确
> 2. 等待下月额度重置（每月1号 00:00）
> 3. 或充值阿里云账户继续使用

---

## 📊 服务详细对比

### 1️⃣ 阿里云语音（当前首选）

#### ✅ 优势
- 🇨🇳 **国内直连**：阿里云服务器，无需 VPN
- 🚀 **速度快**：国内访问延迟低
- 💰 **免费额度大**：每月 120 分钟免费
- 🎙️ **功能强大**：支持说话人分离、词级时间戳
- 📹 **方便**：直接传 URL，无需下载视频

#### 💰 成本
- **免费额度**：120 分钟/月
- **超出后**：¥0.25/分钟（约 $0.035/分钟）

#### 📋 配置情况
```bash
✅ ALIYUN_ACCESS_KEY_ID=LTAI5tEW...（已配置）
✅ ALIYUN_ACCESS_KEY_SECRET=jhKh...（已配置）
✅ ALIYUN_NLS_APP_KEY=GiIU...（已配置）
```

---

### 2️⃣ AssemblyAI（备选方案）

#### ✅ 优势
- 🎁 **免费额度更大**：每月 300 分钟（5小时）
- 🎯 **准确率高**：专业级语音识别
- 🎙️ **功能丰富**：说话人识别、情感分析
- 📹 **便捷**：直接传 URL

#### ⚠️ 劣势
- 🌍 **国际服务**：在中国可能需要 VPN
- 🐢 **速度较慢**：国内访问延迟较高

#### 💰 成本
- **免费额度**：300 分钟/月
- **超出后**：$0.015/分钟

#### 📋 配置情况
```bash
✅ ASSEMBLYAI_API_KEY=ba6e...（已配置）
```

---

### 3️⃣ OpenAI Whisper（保底方案）

#### ✅ 优势
- 🏆 **质量最高**：OpenAI 最先进的语音识别模型
- 🌍 **最稳定**：OpenAI 服务器稳定性好
- 🎯 **准确率高**：支持 97 种语言

#### ⚠️ 劣势
- 💰 **无免费额度**：从第一分钟就开始计费
- 📦 **需要下载**：必须下载视频并压缩成音频
- ⚠️ **文件限制**：音频文件必须 < 25MB

#### 💰 成本
- **费用**：$0.006/分钟（约 ¥0.043/分钟）
- **示例**：10分钟视频 = $0.06 ≈ ¥0.43

#### 📋 配置情况
```bash
✅ OPENAI_API_KEY=sk-proj-M01...（已配置）
```

---

## 💡 实际使用情况

### 典型场景

假设你要分析一个 **10 分钟的英语教学视频**：

#### 场景 1：正常使用（阿里云额度充足）
```
🇨🇳 使用阿里云语音服务
├─ 成本：免费（使用免费额度）
├─ 耗时：~30-60 秒
└─ 剩余额度：110 分钟（从 120 分钟减少）
```

#### 场景 2：阿里云额度用完
```
⚠️  阿里云额度已用完
↓
❌ 系统报错，无法继续
├─ 错误提示：阿里云语音服务不可用（免费额度已用完）
├─ 解决方案：
│   ├─ 等待下月1号额度重置
│   └─ 或充值阿里云账户继续使用
└─ 无法自动降级到其他服务
```

---

## 🎓 说话人识别功能

### 核心功能
你的系统已启用 **说话人识别**（Speaker Diarization），可以：

✅ 自动区分老师和学生的发言  
✅ 为每段对话标注说话人（Speaker A, Speaker B）  
✅ 提供精准的师生互动分析  

### 示例输出

```typescript
// 转录结果包含说话人信息
{
  text: "完整对话文本...",
  utterances: [
    {
      speaker: "A",  // 可能是老师
      text: "Hello! How are you today?",
      start: 0.0,
      end: 2.5
    },
    {
      speaker: "B",  // 可能是学生
      text: "I'm fine, thank you!",
      start: 2.8,
      end: 4.2
    }
  ]
}
```

---

## 📈 成本估算

### 月度成本（按 50 个视频，平均 10 分钟/视频）

| 场景 | 总时长 | 阿里云 | AssemblyAI | Whisper | 总成本 |
|-----|--------|--------|------------|---------|--------|
| **最佳情况** | 500 分钟 | 120分钟免费 | 300分钟免费 | 80分钟付费 | **$0.48** |
| **中等情况** | 500 分钟 | 120分钟免费 | 380分钟（80分钟付费） | 0 | **$1.20** |
| **全用 Whisper** | 500 分钟 | 不用 | 不用 | 500分钟付费 | **$3.00** |

### 💡 成本优化建议

1. **优先用完阿里云免费额度**（120分钟/月）
2. **次选 AssemblyAI**（300分钟/月）
3. **Whisper 作为保底**（按需付费）

**预期总成本**：$0.50 - $1.50 / 月（50个视频）

---

## 🛠️ 如何查看当前使用的服务？

### 方法 1：查看启动日志

```bash
npm run dev
```

启动后会显示类似：

```
============================================================
🎙️ 转录服务状态
============================================================
✅ 阿里云语音: 可用（剩余 120 分钟）
✅ AssemblyAI: 可用（剩余 300 分钟）
✅ OpenAI Whisper: 可用
============================================================
```

### 方法 2：查看分析日志

提交视频分析时，控制台会显示：

```
🇨🇳 [video1] 使用阿里云语音服务（国内免费服务）
💰 当前剩余免费额度: 120 分钟
✅ [video1] 阿里云转录成功！
💰 更新后剩余额度: 110 分钟
```

---

## 🔧 调整配置

### 如果想强制使用特定服务

#### 方案 1：临时禁用阿里云（测试 AssemblyAI）
```bash
# .env 文件
# ALIYUN_ACCESS_KEY_ID=...（注释掉）
# ALIYUN_ACCESS_KEY_SECRET=...（注释掉）
# ALIYUN_NLS_APP_KEY=...（注释掉）

ASSEMBLYAI_API_KEY=ba6e...（保留）
```

#### 方案 2：临时禁用所有免费服务（测试 Whisper）
```bash
# .env 文件
# ALIYUN_ACCESS_KEY_ID=...（注释掉）
# ASSEMBLYAI_API_KEY=...（注释掉）

OPENAI_API_KEY=sk-proj-...（保留）
```

---

## 🎯 总结

### ✅ 当前状态
- **唯一服务**：阿里云语音（强制使用）
- **降级策略**：已禁用（不再支持自动降级）
- **输出一致性**：确保每次使用相同服务，结果一致
- **成本优化**：使用免费额度（120分钟/月）

### 🎁 免费额度
- 阿里云：120 分钟/月（约 12 个 10 分钟视频）

### 💰 超出免费额度后
- 阿里云：¥0.25/分钟（约 $0.035/分钟）
- 需要充值阿里云账户继续使用

### 🚀 推荐策略
1. ✅ **监控免费额度**：注意每月额度使用情况
2. ✅ **合理规划使用**：在免费额度内使用
3. ✅ **等待额度重置**：每月1号 00:00 自动重置
4. ✅ **必要时充值**：超出免费额度后按需充值

### 🔮 未来计划
- 可能会恢复智能降级策略（阿里云 → AssemblyAI → Whisper）
- 届时将支持自动切换，提高可用性

---

**最后更新**：2025-11-07  
**服务商**：阿里云智能语音服务  
**策略**：强制使用（确保输出一致性）

